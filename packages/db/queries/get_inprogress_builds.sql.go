// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: get_inprogress_builds.sql

package queries

import (
	"context"
)

const getInProgressTemplateBuilds = `-- name: GetInProgressTemplateBuilds :many
SELECT DISTINCT ON (b.id) t.id, t.created_at, t.is_blocked, t.name, t.tier, t.email, t.is_banned, t.blocked_reason, t.cluster_id, t.slug, e.id, e.created_at, e.updated_at, e.public, e.build_count, e.spawn_count, e.last_spawned_at, e.team_id, e.created_by, e.cluster_id, e.source, b.id, b.created_at, b.updated_at, b.finished_at, b.status, b.dockerfile, b.start_cmd, b.vcpu, b.ram_mb, b.free_disk_size_mb, b.total_disk_size_mb, b.kernel_version, b.firecracker_version, b.env_id, b.envd_version, b.ready_cmd, b.cluster_node_id, b.reason, b.version, b.cpu_architecture, b.cpu_family, b.cpu_model, b.cpu_model_name, b.cpu_flags
FROM public.env_builds b
JOIN public.env_build_assignments eba ON eba.build_id = b.id
JOIN public.envs e ON e.id = eba.env_id
JOIN public.teams t ON e.team_id = t.id
WHERE b.status IN ('waiting', 'building', 'snapshotting', 'pending', 'in_progress')
ORDER BY b.id, b.created_at DESC
`

type GetInProgressTemplateBuildsRow struct {
	Team     Team
	Env      Env
	EnvBuild EnvBuild
}

func (q *Queries) GetInProgressTemplateBuilds(ctx context.Context) ([]GetInProgressTemplateBuildsRow, error) {
	rows, err := q.db.Query(ctx, getInProgressTemplateBuilds)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetInProgressTemplateBuildsRow
	for rows.Next() {
		var i GetInProgressTemplateBuildsRow
		if err := rows.Scan(
			&i.Team.ID,
			&i.Team.CreatedAt,
			&i.Team.IsBlocked,
			&i.Team.Name,
			&i.Team.Tier,
			&i.Team.Email,
			&i.Team.IsBanned,
			&i.Team.BlockedReason,
			&i.Team.ClusterID,
			&i.Team.Slug,
			&i.Env.ID,
			&i.Env.CreatedAt,
			&i.Env.UpdatedAt,
			&i.Env.Public,
			&i.Env.BuildCount,
			&i.Env.SpawnCount,
			&i.Env.LastSpawnedAt,
			&i.Env.TeamID,
			&i.Env.CreatedBy,
			&i.Env.ClusterID,
			&i.Env.Source,
			&i.EnvBuild.ID,
			&i.EnvBuild.CreatedAt,
			&i.EnvBuild.UpdatedAt,
			&i.EnvBuild.FinishedAt,
			&i.EnvBuild.Status,
			&i.EnvBuild.Dockerfile,
			&i.EnvBuild.StartCmd,
			&i.EnvBuild.Vcpu,
			&i.EnvBuild.RamMb,
			&i.EnvBuild.FreeDiskSizeMb,
			&i.EnvBuild.TotalDiskSizeMb,
			&i.EnvBuild.KernelVersion,
			&i.EnvBuild.FirecrackerVersion,
			&i.EnvBuild.EnvID,
			&i.EnvBuild.EnvdVersion,
			&i.EnvBuild.ReadyCmd,
			&i.EnvBuild.ClusterNodeID,
			&i.EnvBuild.Reason,
			&i.EnvBuild.Version,
			&i.EnvBuild.CpuArchitecture,
			&i.EnvBuild.CpuFamily,
			&i.EnvBuild.CpuModel,
			&i.EnvBuild.CpuModelName,
			&i.EnvBuild.CpuFlags,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
