// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: get_checkpoint.sql

package queries

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const getCheckpoint = `-- name: GetCheckpoint :one
SELECT 
    eba.build_id as checkpoint_id,
    eba.tag as name,
    eba.created_at,
    s.sandbox_id,
    s.env_id as template_id,
    eb.cluster_node_id,
    eb.vcpu,
    eb.ram_mb,
    eb.total_disk_size_mb,
    eb.kernel_version,
    eb.firecracker_version,
    eb.envd_version
FROM "public"."env_build_assignments" eba
JOIN "public"."env_builds" eb ON eb.id = eba.build_id
JOIN "public"."snapshots" s ON s.env_id = eba.env_id
WHERE eba.build_id = $1
AND s.sandbox_id = $2
AND s.team_id = $3
AND eba.tag != 'default'
`

type GetCheckpointParams struct {
	CheckpointID uuid.UUID
	SandboxID    string
	TeamID       uuid.UUID
}

type GetCheckpointRow struct {
	CheckpointID       uuid.UUID
	Name               string
	CreatedAt          pgtype.Timestamptz
	SandboxID          string
	TemplateID         string
	ClusterNodeID      *string
	Vcpu               int64
	RamMb              int64
	TotalDiskSizeMb    *int64
	KernelVersion      string
	FirecrackerVersion string
	EnvdVersion        *string
}

// Gets a specific checkpoint by build_id (checkpoint ID).
// Validates that the checkpoint belongs to the specified sandbox and team.
func (q *Queries) GetCheckpoint(ctx context.Context, arg GetCheckpointParams) (GetCheckpointRow, error) {
	row := q.db.QueryRow(ctx, getCheckpoint, arg.CheckpointID, arg.SandboxID, arg.TeamID)
	var i GetCheckpointRow
	err := row.Scan(
		&i.CheckpointID,
		&i.Name,
		&i.CreatedAt,
		&i.SandboxID,
		&i.TemplateID,
		&i.ClusterNodeID,
		&i.Vcpu,
		&i.RamMb,
		&i.TotalDiskSizeMb,
		&i.KernelVersion,
		&i.FirecrackerVersion,
		&i.EnvdVersion,
	)
	return i, err
}
