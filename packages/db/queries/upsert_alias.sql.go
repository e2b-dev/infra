// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: upsert_alias.sql

package queries

import (
	"context"
)

const upsertTemplateAliasIfNotExists = `-- name: UpsertTemplateAliasIfNotExists :one
WITH inserted AS (
    INSERT INTO "public"."env_aliases" (alias, env_id, is_renamable, namespace)
    VALUES ($1, $2, TRUE, $3)
    ON CONFLICT (alias, namespace) DO NOTHING
    RETURNING env_id
)
SELECT env_id FROM inserted
UNION ALL
SELECT env_id FROM "public"."env_aliases" 
WHERE alias = $1 
  AND namespace IS NOT DISTINCT FROM $3
  AND NOT EXISTS (SELECT 1 FROM inserted)
LIMIT 1
`

type UpsertTemplateAliasIfNotExistsParams struct {
	Alias      string
	TemplateID string
	Namespace  *string
}

// Attempts to create an alias. Returns the env_id that the alias points to.
// If the alias already exists, returns the existing env_id without modifying it.
// Uses ON CONFLICT DO NOTHING to avoid race conditions.
func (q *Queries) UpsertTemplateAliasIfNotExists(ctx context.Context, arg UpsertTemplateAliasIfNotExistsParams) (string, error) {
	row := q.db.QueryRow(ctx, upsertTemplateAliasIfNotExists, arg.Alias, arg.TemplateID, arg.Namespace)
	var env_id string
	err := row.Scan(&env_id)
	return env_id, err
}
