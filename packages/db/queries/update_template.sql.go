// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: update_template.sql

package queries

import (
	"context"

	"github.com/google/uuid"
)

const updateTemplate = `-- name: UpdateTemplate :one
UPDATE "public"."envs" e
SET public = $1
WHERE id IN (
    SELECT e.id FROM "public"."envs" e
    LEFT JOIN "public"."env_aliases" ea ON ea.env_id = e.id
    WHERE e.team_id = $2
    AND e.source = 'template'
    AND (e.id = $3 OR ea.alias = $3)
)
RETURNING e.id
`

type UpdateTemplateParams struct {
	Public            bool
	TeamID            uuid.UUID
	TemplateIDOrAlias string
}

func (q *Queries) UpdateTemplate(ctx context.Context, arg UpdateTemplateParams) (string, error) {
	row := q.db.QueryRow(ctx, updateTemplate, arg.Public, arg.TeamID, arg.TemplateIDOrAlias)
	var id string
	err := row.Scan(&id)
	return id, err
}

const updateTemplateBuild = `-- name: UpdateTemplateBuild :exec
UPDATE "public"."env_builds"
SET
    start_cmd = $1,
    ready_cmd = $2,
    dockerfile = $3,
    cluster_node_id = $4,
    cpu_architecture = $5,
    cpu_family = $6,
    cpu_model = $7,
    cpu_model_name = $8,
    cpu_flags = $9
WHERE
    id = $10
`

type UpdateTemplateBuildParams struct {
	StartCmd        *string
	ReadyCmd        *string
	Dockerfile      *string
	ClusterNodeID   *string
	CpuArchitecture *string
	CpuFamily       *string
	CpuModel        *string
	CpuModelName    *string
	CpuFlags        []string
	BuildUuid       uuid.UUID
}

func (q *Queries) UpdateTemplateBuild(ctx context.Context, arg UpdateTemplateBuildParams) error {
	_, err := q.db.Exec(ctx, updateTemplateBuild,
		arg.StartCmd,
		arg.ReadyCmd,
		arg.Dockerfile,
		arg.ClusterNodeID,
		arg.CpuArchitecture,
		arg.CpuFamily,
		arg.CpuModel,
		arg.CpuModelName,
		arg.CpuFlags,
		arg.BuildUuid,
	)
	return err
}
